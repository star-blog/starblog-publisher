<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:StarBlogPublisher.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:md="clr-namespace:Markdown.Avalonia;assembly=Markdown.Avalonia"
        xmlns:i="https://github.com/projektanker/icons.avalonia"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="650"
        x:Class="StarBlogPublisher.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="StarBlogPublisher"
        WindowStartupLocation="CenterOwner"
        MinWidth="800" MinHeight="600">

    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto" Background="{DynamicResource SystemChromeLowColor}">
        <!-- é¡¶éƒ¨åŒºåŸŸï¼šLogoå’Œè½¯ä»¶ä¿¡æ¯ -->
        <Border Classes="Card" Grid.Row="0" Margin="10">
            <Grid ColumnDefinitions="Auto,*,Auto" Margin="10">
                <!-- Logo -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="StarBlog Publisher" FontSize="24" FontWeight="Bold" Margin="0,0,10,0" />
                </StackPanel>

                <!-- ç©ºç™½åŒºåŸŸ -->
                <Grid Grid.Column="1" />

                <!-- è½¯ä»¶ä¿¡æ¯å’Œä¸»é¢˜åˆ‡æ¢ -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8"
                            VerticalAlignment="Center">
                    <!-- ç™»å½•çŠ¶æ€å’ŒæŒ‰é’® -->
                    <Border Grid.Column="2" Classes="Card" Padding="8,4" Margin="0,0,10,0">
                        <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                            <TextBlock Text="{Binding LoginStatusMessage}"
                                       VerticalAlignment="Center"
                                       FontSize="12" />
                            <Button Content="ç™»å½•"
                                    Command="{Binding LoginCommand}"
                                    IsVisible="{Binding !IsLoggedIn}"
                                    Classes="IconButton"
                                    Padding="8,3" />
                            <Button Content="ç™»å‡º"
                                    Command="{Binding LogoutCommand}"
                                    IsVisible="{Binding IsLoggedIn}"
                                    Classes="IconButton"
                                    Padding="8,3" />
                        </StackPanel>
                    </Border>

                    <Button Command="{Binding ToggleThemeCommand}"
                            Content="{Binding IsDarkTheme, Converter={StaticResource BoolToThemeTextConverter}}"
                            Padding="10"
                            Classes="IconButton" />
                    <Button Content="âš™ï¸ è®¾ç½®" Padding="10"
                            Classes="IconButton"
                            Command="{Binding ShowSettingsCommand}" />
                    <Button Content="ðŸ¤– AIé…ç½®" Padding="10"
                            Classes="IconButton"
                            Command="{Binding ShowAiSettingsCommand}" />
                    <Button Content="â„¹ï¸ å…³äºŽ" Padding="10"
                            Classes="IconButton"
                            Command="{Binding ShowAboutCommand}" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <Grid Grid.Row="1" ColumnDefinitions="*,*" Margin="10">
            <!-- å·¦ä¾§ï¼šæ–‡ä»¶é€‰æ‹©å’Œæ–‡æœ¬æ˜¾ç¤º -->
            <Grid Grid.Column="0" RowDefinitions="Auto,*" Margin="0,0,5,0">
                <!-- æ–‡ä»¶æ‹–æ”¾åŒºåŸŸ -->
                <Border Grid.Row="0"
                        BorderBrush="{DynamicResource SystemAccentColor}"
                        BorderThickness="2"
                        CornerRadius="4"
                        Padding="10"
                        Margin="0,0,0,10"
                        DragDrop.AllowDrop="True">
                    <Grid RowDefinitions="*,Auto">
                        <TextBlock Grid.Row="0"
                                   Text="æ‹–æ”¾Markdownæ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Margin="0,10" />
                        <Button Grid.Row="1"
                                Content="é€‰æ‹©æ–‡ä»¶"
                                HorizontalAlignment="Center"
                                Command="{Binding SelectFileCommand}" />
                    </Grid>
                </Border>

                <!-- æ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸ -->
                <Border Grid.Row="1"
                        BorderBrush="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                        BorderThickness="1"
                        CornerRadius="4">
                    <ScrollViewer>
                        <TextBox Text="{Binding ArticleContent}"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 IsReadOnly="True" />
                    </ScrollViewer>
                </Border>
            </Grid>

            <!-- å³ä¾§ï¼šæ–‡ç« ä¿¡æ¯ç¼–è¾‘åŒºåŸŸ -->
            <Grid Grid.Column="1" RowDefinitions="*" Margin="5,0,0,0">
                <!-- æ–‡ç« ä¿¡æ¯ç¼–è¾‘åŒºåŸŸ -->
                <Border Grid.Row="0"
                        Classes="Card"
                        Background="{DynamicResource SystemAltHighColor}">
                    <Grid RowDefinitions="Auto,Auto,*" Margin="10">
                        <TextBlock Grid.Row="0" Margin="5"
                                   Text="æ–‡ç« ä¿¡æ¯" FontWeight="Bold" FontSize="16" />

                        <!-- æ ‡é¢˜è¾“å…¥ -->
                        <StackPanel Grid.Row="1" Spacing="5" Margin="5">
                            <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                                <TextBlock Grid.Column="0" Text="æ ‡é¢˜" FontWeight="SemiBold" VerticalAlignment="Center" />
                                <Button Grid.Column="2"
                                        Content="â†©ï¸ é‡ç½®"
                                        ToolTip.Tip="é‡ç½®ä¸ºæ–‡ä»¶å"
                                        Command="{Binding ResetTitleCommand}"
                                        Classes="IconButton"
                                        Padding="5,2" />
                                <Button Grid.Column="3"
                                        Content="ðŸ”„ AIæ¶¦è‰²"
                                        ToolTip.Tip="ä½¿ç”¨AIæ¶¦è‰²æ–‡ç« æ ‡é¢˜"
                                        Command="{Binding RefineTitleWithAICommand}"
                                        IsVisible="{Binding IsAIEnabled}"
                                        IsEnabled="{Binding !IsRefiningTitle}"
                                        Classes="IconButton"
                                        Padding="5,2"
                                        Margin="0,0,5,0" />
                            </Grid>
                            <TextBox Text="{Binding ArticleTitle}"
                                     Watermark="è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜" />
                        </StackPanel>

                        <!-- è¯´æ˜Žå’Œåˆ†ç±»åŒºåŸŸï¼ˆå·¦å³ä¸¤æ ï¼‰ -->
                        <Grid Grid.Row="2" ColumnDefinitions="*,*" Margin="5">
                            <!-- å·¦ä¾§ -->
                            <Grid Grid.Row="0" Grid.Column="0" RowDefinitions="*,Auto">
                                <!-- å·¦ä¾§ï¼šè¯´æ˜Žè¾“å…¥ -->
                                <Grid Grid.Row="0" RowDefinitions="Auto,*" Margin="0,0,5,0">
                                    <Grid ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,5">
                                        <TextBlock Grid.Column="0" Text="è¯´æ˜Ž" FontWeight="SemiBold"
                                                   VerticalAlignment="Center" />
                                        <Button Grid.Column="2"
                                                Content="ðŸ”„ é‡æ–°ç”Ÿæˆ"
                                                ToolTip.Tip="ä½¿ç”¨AIé‡æ–°ç”Ÿæˆæ–‡ç« ç®€ä»‹"
                                                Command="{Binding RegenerateDescriptionCommand}"
                                                IsVisible="{Binding IsAIEnabled}"
                                                Classes="IconButton"
                                                Padding="5,2" />
                                    </Grid>
                                    <TextBox Grid.Row="1"
                                             Text="{Binding ArticleDescription}"
                                             AcceptsReturn="True"
                                             TextWrapping="Wrap"
                                             Watermark="è¯·è¾“å…¥æ–‡ç« è¯´æ˜Ž" />
                                </Grid>

                                <!-- Slugè¾“å…¥ -->
                                <StackPanel Grid.Row="1" Spacing="5" Margin="0,5,5,0">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <TextBlock Grid.Column="0" Text="Slug" FontWeight="SemiBold"
                                                   VerticalAlignment="Center" />
                                        <Button Grid.Column="2"
                                                Content="ðŸ”„ ç”Ÿæˆ"
                                                ToolTip.Tip="ä½¿ç”¨AIç”Ÿæˆæ–‡ç« Slug"
                                                Command="{Binding GenerateSlugCommand}"
                                                IsVisible="{Binding IsAIEnabled}"
                                                Classes="IconButton"
                                                Padding="5,2" />
                                    </Grid>
                                    <TextBox Text="{Binding ArticleSlug}"
                                             Watermark="ç”¨äºŽURLçš„æ–‡ç« æ ‡è¯†ï¼ˆå¦‚ï¼šmy-first-articleï¼‰" />
                                </StackPanel>
                            </Grid>

                            <!-- å³ä¾§ï¼šåˆ†ç±»é€‰æ‹© -->
                            <Grid Grid.Column="1" RowDefinitions="Auto,*" Margin="5,0,0,0"
                                  IsVisible="{Binding IsLoggedIn}">
                                <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto,Auto,Auto" Margin="0,0,0,5">
                                    <TextBlock Grid.Column="0" Text="åˆ†ç±»" FontWeight="SemiBold"
                                               VerticalAlignment="Center" />
                                    <Button Grid.Column="2" Content="âž•" ToolTip.Tip="æ·»åŠ åˆ†ç±»"
                                            Command="{Binding ShowAddCategoryCommand}"
                                            Classes="IconButton" Padding="5,2"
                                            Margin="0,0,5,0" />
                                    <Button Grid.Column="3" Content="â˜ï¸" ToolTip.Tip="æŸ¥çœ‹è¯äº‘"
                                            Command="{Binding ShowWordCloudCommand}"
                                            Classes="IconButton" Padding="5,2"
                                            Margin="0,0,5,0" />
                                    <Button Grid.Column="4" Content="ðŸ”„" ToolTip.Tip="åˆ·æ–°åˆ†ç±»"
                                            Command="{Binding RefreshCategoriesCommand}"
                                            Classes="IconButton" Padding="5,2" />
                                </Grid>
                                <TreeView Grid.Row="1"
                                          MinHeight="100"
                                          BorderBrush="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                                          BorderThickness="2"
                                          CornerRadius="4"
                                          ItemsSource="{Binding Categories}"
                                          SelectedItem="{Binding SelectedCategory}">
                                    <TreeView.ItemTemplate>
                                        <TreeDataTemplate ItemsSource="{Binding Nodes}">
                                            <TextBlock Text="{Binding Text}" />
                                        </TreeDataTemplate>
                                    </TreeView.ItemTemplate>
                                </TreeView>
                            </Grid>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
        </Grid>


        <!-- åº•éƒ¨åŒºåŸŸï¼šé¢„è§ˆæŒ‰é’®ã€å‘å¸ƒæŒ‰é’®ã€è¿›åº¦æ¡å’ŒçŠ¶æ€æ˜¾ç¤º -->
        <Grid Grid.Row="2" ColumnDefinitions="Auto,Auto,Auto,*,Auto" Margin="10">
            <!-- é¢„è§ˆæŒ‰é’® -->
            <Button Grid.Column="0"
                    Content="ðŸ‘€ é¢„è§ˆæ–‡ç« "
                    Command="{Binding PreviewCommand}"
                    IsEnabled="{Binding CanPublish}"
                    Padding="15,10"
                    Margin="0,0,10,0" />

            <!-- å‘å¸ƒæŒ‰é’® -->
            <Button Grid.Column="1"
                    Content="â« å‘å¸ƒæ–‡ç« "
                    Command="{Binding PublishCommand}"
                    IsEnabled="{Binding CanPublish}"
                    Padding="15,10"
                    Margin="0,0,10,0" />

            <!-- å¤åˆ¶æŒ‰é’® -->
            <Button Grid.Column="2"
                    Content="ðŸ“‹ å¤åˆ¶å†…å®¹"
                    Command="{Binding CopyContentCommand}"
                    Padding="15,10"
                    Margin="0,0,10,0" />

            <!-- è¿›åº¦æ¡ -->
            <ProgressBar Grid.Column="3"
                         Value="{Binding PublishProgress}"
                         IsVisible="{Binding IsPublishing}"
                         Margin="10,0" />

            <!-- çŠ¶æ€æ˜¾ç¤º -->
            <TextBlock Grid.Column="4"
                       Text="{Binding StatusMessage}"
                       VerticalAlignment="Center" />
        </Grid>
    </Grid>
</Window>